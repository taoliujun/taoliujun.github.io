---
title: 4. Using workflows - GitHub Actions
title_url: github-actions-using-workflows
date: 2022-07-07
tags:
  - github actions
  - ci
categories:
  - 架构
---

官方文档：https://docs.github.com/en/actions/using-workflows/about-workflows

原文很长，但随着对 Github Actions 的了解，笔记也会越来越短。

## 介绍

更详细介绍了 workflow 的构成，没啥特别重要点。

## 触发

再次复习下触发的几种情况：github、计划任务、手动。

### Branches 过滤

可以通过 branches 、branches-ignore 过滤或排除分支，支持 glob patterns。还可以在 branches 前面用!修饰为“非”。比如：

```yaml
on:
  pull_request:
    branches:
      - "releases/**"
      - "!releases/**-alpha"
```

### Tags 过滤

对于 tags 的过滤处理和 branches 是一致的，只是修改了名字为 tags、tags-ignore。

### Types 过滤

可以理解为事件的具体行为，比如 issue_commot 事件的 created 行为。

### Paths 过滤

文件路径过滤也是基本功能了，使用 paths、paths-ignore 处理，举例：

```yaml
on:
  push:
    paths:
      - '**.js
```

注意，一些过滤场景并不允许 a 和 a-ignore 一起使用，需要注意的。

### 其他

- 还可以对 input 进行参数过滤，以满足更丰富的触发条件配置。
- 对 github 的属性，如 pull request 发起人的名字进行过滤。

## 事件

列举了常见的 30 几种事件，大部分事件包含多种行为。

## 语法

涵盖了 workflow 的大部分配置项。

## 命令行

actions 如何和 bash 交换变量，使用 actions/toolkit 可以简单做到。

## 复用

注意复用的上下文

## 缓存

可以缓存 npm 的依赖以节省 install 的时间，注意缓存的跨分支适用策略。
